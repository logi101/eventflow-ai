---
phase: 07-networking-vip-infrastructure
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - eventflow-app/src/components/participants/TrackChip.tsx
  - eventflow-app/src/components/participants/TrackAssignmentBulk.tsx
  - eventflow-app/src/hooks/useTrackAssignment.ts
  - eventflow-app/src/types/participant.ts
autonomous: true

must_haves:
  truths:
    - "Manager can select multiple participants and assign a track to all at once"
    - "Manager can toggle individual tracks on/off in participant modal"
    - "Tracks display as color-coded chips in participant lists"
  artifacts:
    - path: "eventflow-app/src/components/participants/TrackChip.tsx"
      provides: "Color-coded track badge component"
      min_lines: 25
    - path: "eventflow-app/src/components/participants/TrackAssignmentBulk.tsx"
      provides: "Bulk track assignment UI for selected participants"
      min_lines: 50
    - path: "eventflow-app/src/hooks/useTrackAssignment.ts"
      provides: "Track assignment state management"
      exports: ["useTrackAssignment"]
  key_links:
    - from: "TrackAssignmentBulk.tsx"
      to: "participant_tracks"
      via: "supabase insert"
      pattern: "from\\('participant_tracks'\\)"
    - from: "useTrackAssignment.ts"
      to: "supabase"
      via: "mutation hook"
      pattern: "useMutation"
---

<objective>
Create track assignment UI for bulk and individual participant track management

Purpose: Enable managers to assign interest tracks to participants for intelligent seating algorithm input
Output: TrackChip display component, bulk assignment interface, and useTrackAssignment hook with TanStack Query
</objective>

<execution_context>
@/Users/eliyawolfman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/eliyawolfman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-networking-vip-infrastructure/07-CONTEXT.md
@.planning/phases/07-networking-vip-infrastructure/07-RESEARCH.md
@eventflow-app/supabase/migrations/20260120_program_management.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TrackChip component</name>
  <files>eventflow-app/src/components/participants/TrackChip.tsx, eventflow-app/src/types/participant.ts</files>
  <action>
1. **Add Track type to participant.ts if not exists:**
   ```typescript
   export interface Track {
     id: string
     name: string
     color: string
     event_id: string
   }

   export interface ParticipantWithTracks extends Participant {
     tracks: Track[]
   }
   ```

2. **Create TrackChip.tsx:**
   - Props: track (Track), onRemove? (optional callback), size ('xs' | 'sm' | 'md')
   - Display track name with background color at 20% opacity, border at full color
   - Include optional X button for removal
   - RTL-ready styling

   ```typescript
   interface TrackChipProps {
     track: Track
     onRemove?: () => void
     size?: 'xs' | 'sm' | 'md'
   }
   ```

   Styling approach:
   - Use inline style for dynamic color (Tailwind can't handle dynamic colors)
   - Background: `${track.color}20` (20% opacity hex)
   - Border and text: full track.color
   - Rounded pill shape (rounded-full)
   - Small text with inline-flex layout
   - Optional remove button (×) with hover opacity change
  </action>
  <verify>
- TypeScript compiles without errors
- TrackChip renders with correct dynamic colors
- Remove button only appears when onRemove provided
  </verify>
  <done>TrackChip component displays color-coded track badge with optional remove functionality</done>
</task>

<task type="auto">
  <name>Task 2: Create useTrackAssignment hook</name>
  <files>eventflow-app/src/hooks/useTrackAssignment.ts</files>
  <action>
Create React Query-based hook for track assignment operations:

1. **assignTracks mutation:**
   - Bulk insert participant_tracks for multiple participants
   - Invalidate participants and track-statistics queries on success
   - Handle conflicts gracefully (ON CONFLICT DO NOTHING)

2. **removeTrack mutation:**
   - Delete single participant_track entry
   - Invalidate relevant queries

3. **toggleTrack mutation:**
   - Check if assignment exists, then add or remove
   - Uses maybeSingle() for existence check

```typescript
interface AssignTracksParams {
  participantIds: string[]
  trackId: string
  isPrimary?: boolean
}

export function useTrackAssignment(eventId: string) {
  const queryClient = useQueryClient()

  const assignTracks = useMutation({...})
  const removeTrack = useMutation({...})
  const toggleTrack = useMutation({...})

  return { assignTracks, removeTrack, toggleTrack }
}
```

Follow patterns from 07-RESEARCH.md Track Assignment section.
  </action>
  <verify>
- TypeScript compiles without errors
- Hook exports assignTracks, removeTrack, toggleTrack
- Mutations use correct Supabase table (participant_tracks)
  </verify>
  <done>useTrackAssignment hook manages all track assignment operations with proper cache invalidation</done>
</task>

<task type="auto">
  <name>Task 3: Create TrackAssignmentBulk component</name>
  <files>eventflow-app/src/components/participants/TrackAssignmentBulk.tsx</files>
  <action>
Create bulk track assignment bar that appears when participants are selected:

1. **Component props:**
   ```typescript
   interface TrackAssignmentBulkProps {
     selectedParticipantIds: string[]
     eventTracks: Track[]
     eventId: string
     onClearSelection: () => void
   }
   ```

2. **UI Layout (RTL):**
   - Blue background bar (bg-blue-50 border border-blue-200)
   - Display count: "{N} נבחרו"
   - Track buttons for each available track (showing TrackChip)
   - "ביטול בחירה" (Clear selection) button

3. **Behavior:**
   - Click track button → assignTracks mutation for all selected participants
   - Clear selection after successful assignment
   - Show loading state during mutation
   - Appear only when selectedParticipantIds.length > 0

4. **Styling:**
   - Hebrew text, RTL layout
   - Matches EventFlow design system (Tailwind classes)
   - Responsive flex layout
  </action>
  <verify>
- TypeScript compiles without errors
- Component renders only when participants selected
- Track assignment calls useTrackAssignment hook
- Selection cleared after successful assignment
  </verify>
  <done>TrackAssignmentBulk component enables bulk track assignment for selected participants</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. TrackChip renders with dynamic colors based on track.color
2. useTrackAssignment hook correctly performs CRUD on participant_tracks
3. TrackAssignmentBulk shows when participants selected and assigns tracks
4. All components follow RTL-first Hebrew UI patterns
</verification>

<success_criteria>
- Manager can assign interest tracks to participants via bulk selection (NETW-01)
- Tracks displayed as color-coded chips in participant lists (CONTEXT.md decision)
- Both bulk and individual track assignment methods available (CONTEXT.md decision)
- Track assignment uses existing participant_tracks table
</success_criteria>

<output>
After completion, create `.planning/phases/07-networking-vip-infrastructure/07-03-SUMMARY.md`
</output>
