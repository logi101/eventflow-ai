---
phase: 11-tier-enforcement
plan: 01
type: execute
wave: 1
depends_on: [10-01]
files_modified:
  - eventflow-app/supabase/functions/_shared/quota-check.ts
autonomous: true

must_haves:
  truths:
    - "checkQuota(supabaseClient, userId, quotaType) function exists"
    - "Returns { allowed, remaining, tier, resetDate } object"
    - "Always returns allowed: true for Premium tier"
    - "Checks current_usage against tier_limits for Base tier"
    - "Supports quota types: events, participants, messages, ai_messages"
    - "Completes in <100ms"

---

<objective>
Create reusable Edge Function utility for checking tier and quota limits.

Purpose: Centralize quota checking logic for all Edge Functions to ensure consistency and reduce code duplication. The function queries the organizations table for tier and usage data, checks limits, and returns a standardized response.

Output: TypeScript utility file with checkQuota function.
</objective>

<execution_context>
@/Users/eliyawolfman/.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/REQUIREMENTS.md (P2.1 Quota Check Middleware)
@.planning/ROADMAP.md (Phase 2: Enforcement, P2.1 Tasks)
@.planning/phases/10-tier-foundation/10-CONTEXT.md
</context>

<output>
After completion, create `.planning/phases/11-tier-enforcement/11-01-SUMMARY.md`
</output>
